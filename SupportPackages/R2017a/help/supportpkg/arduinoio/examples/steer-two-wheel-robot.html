<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" itemscope itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Steer Two-Wheel Robot</title>
<link rel="stylesheet" href="docstyle.css" type="text/css"><link href="../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css">


  <meta http-equiv="Content-Script-Type" content="text/javascript">
<meta name="toctype" itemprop="pagetype" content="fe">
<meta name="infotype" itemprop="infotype" content="ex" />

<meta name="description" itemprop="description" content="This example shows how to use the MATLAB&reg; Support Package for Arduino&reg; Hardware to steer a two-wheel Arduino-based robot with closed-loop control." />
<meta content="../../../examples/arduinoio_product/win64/RotaryEncoderSpeedExample_02.png" itemprop="thumbnailUrl">
<script type="text/javascript" src="../includes/product/scripts/jquery/jquery-latest.js"></script>
<link href="../includes/product/css/site6.css?201706221414" rel="stylesheet" type="text/css">
<link href="../includes/product/css/site6_lg.css?201706221414" rel="stylesheet" media="screen and (min-width: 1200px)">
<link href="../includes/product/css/site6_md.css?201706221414" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)">
<link href="../includes/product/css/site6_sm+xs.css?201706221414" rel="stylesheet" media="screen and (max-width: 991px)">
<link href="../includes/product/css/site6_sm.css?201706221414" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)">
<link href="../includes/product/css/site6_xs.css?201706221414" rel="stylesheet" media="screen and (max-width: 767px)">
<link href="../includes/product/css/site6_offcanvas.css?201706221414" rel="stylesheet" type="text/css">

<script src="../includes/shared/scripts/l10n.js"></script>
<script src="../includes/shared/scripts/docscripts.js"></script>
<script src="../includes/shared/scripts/f1help.js"></script>
<script src="../includes/product/scripts/docscripts.js"></script>
<script src="../includes/shared/scripts/mw.imageanimation.js"></script>
<script src="../includes/shared/scripts/jquery.highlight.js"></script>
<script src="../includes/product/scripts/underscore-min.js"></script>
<script src="../includes/product/scripts/examples.js"></script>
<script src="../includes/product/scripts/use_platform_screenshots.js"></script>
<script src="../includes/product/scripts/suggest.js"></script>
<script src="../includes/shared/scripts/overload.js"></script>





<script src="../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script src="../includes/product/scripts/bootstrap.min.js" type="text/javascript"></script>
<script src="../includes/product/scripts/global.js"></script>
<link href="../includes/product/css/doc_center.css" rel="stylesheet" type="text/css">
<link href="../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css">
<link href="../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print">
<script type="text/javascript" src="../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div id="doc_header_spacer" class="header"></div>
<div class="sticky_header_container includes_subnav">
<div class="section_header level_3">
<div class="container-fluid">
<div class="row" id="mobile_search_row">
<div class="col-xs-12 col-sm-6 col-sm-push-6 col-md-5 col-md-push-7" id="mobile_search">
<div class="search_nested_content_container">
<form id="docsearch_form" name="docsearch_form" method="get" data-release="R2017a" data-language="en" action="../../../templates/searchresults.html">
<div class="input-group tokenized_search_field">
<label class="sr-only">Search Help</label>
<input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch">
<div class="input-group-btn">
<button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button>
</div>
</div>
</form>
</div>
<button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
<div class="col-sm-6 col-sm-pull-6 col-md-7 col-md-pull-5" id="section_header_title">
<div class="section_header_content">
<div class="section_header_title">
<h1><a href="../../../examples.html">Examples</a></h1>
</div>
</div>
</div>
<div class="visible-xs" id="search_actuator">
<button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button>
</div>
</div><!--END.CLASS row-->
</div><!--END.CLASS container-fluid-->
</div><!--END.CLASS section_header level_3-->
<div class="horizontal_nav">
<div class="horizontal_nav_container">
<div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle">
<button type="button" class="btn"><span class="sr-only">Toggle navigation</span><span class="icon-menu icon_24"></span></button>
<span class="offcanvas_actuator_label"></span><span class="offcanvas_actuator_close"></span>
</div>
<div class="offcanvas_horizontal_nav">
<div class="container-fluid">
<div class="row">
<div class="col-md-12 hidden-xs hidden-sm"></div>
</div>
</div>
</div>
</div>
</div>
</div><!--END.CLASS sticky_header_container-->
<div class="row-offcanvas row-offcanvas-left">
<div class="sidebar-offcanvas" id="sidebar" role="navigation">
<nav class="offcanvas_nav" role="navigation">
<ul xmlns:atict="http://www.arbortext.com/namespace/atict" class="nav_breadcrumb">
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../../examples.html" itemprop="url"><span itemprop="title">Examples Home</span></a></li>
</ul>

<ul xmlns:atict="http://www.arbortext.com/namespace/atict" class="nav_disambiguation">
<li class="product"><a href="../examples.html">MATLAB Support Package for Arduino Hardware</a>
<div class="dropdown">
<span class="icon-arrow-down icon_16" id="dropdownMenu1" data-toggle="dropdown"></span>
<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">
<li role="presentation"><a role="menuitem" tabindex="-1" href="../index.html?s_cid=doc_flyout">Documentation</a></li>
<li role="presentation"><a role="menuitem" tabindex="-1" href="../troubleshooting-in-matlab-support-package-for-arduino-hardware.html?s_cid=doc_flyout">Troubleshooting</a></li>
<li role="presentation"><a role="menuitem" tabindex="-1" href="../functionlist.html?s_cid=doc_flyout">Functions and Other Reference</a></li>
<li role="presentation"><a role="menuitem" tabindex="-1" href="../release-notes.html?s_cid=doc_flyout">Release Notes</a></li>
</ul>
</div>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../examples.html#d0e29" itemprop="url"><span itemprop="title">Tutorials</span></a></li>
</ul>
<ul xmlns:atict="http://www.arbortext.com/namespace/atict" class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Steer Two-Wheel Robot</a></li>
<li class="nav_scrollspy_title">On this page</li>

<li><a href="#zmw57dd0e1095" class="intrnllnk">Hardware Requirements</a></li>
<li><a href="#zmw57dd0e1109" class="intrnllnk">Hardware Setup</a></li>
<li><a href="#zmw57dd0e1133" class="intrnllnk">Create Rotary Encoder Objects</a></li>
<li><a href="#zmw57dd0e1152" class="intrnllnk">Turn On Motors</a></li>
<li><a href="#zmw57dd0e1164" class="intrnllnk">Measure Motor Speeds</a></li>
<li><a href="#zmw57dd0e1180" class="intrnllnk">Steer Robot Straight</a></li>
<li><a href="#zmw57dd0e1209" class="intrnllnk">Clean Up</a></li>


</ul>
</nav>
<script src="../includes/product/scripts/offcanvas.js"></script></div><!--END.CLASS sidebar-offcanvas-->
<div class="content_container" id="content_container">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<section id="doc_center_content" lang="en"><div id="pgtype-example">
<span id="example-RotaryEncoderSpeedExample" class="anchor_target"></span><div class="example_icon"></div><h2 class="title r2017a example" itemprop="title content" id="example-RotaryEncoderSpeedExample">Steer Two-Wheel Robot</h2><div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="arduinoio_product-RotaryEncoderSpeedExample"/><meta itemprop="exampletitle" content="Steer TwoWheel Robot"/></div><span id="RotaryEncoderSpeedExample" class="anchor_target"></span><div itemprop="content">

<p>This example shows how to use the MATLAB&reg; Support Package for Arduino&reg; Hardware to steer a two-wheel Arduino-based robot with closed-loop control.</p>

</div><div class="clearfix"></div><div itemprop="content"><span id="zmw57dd0e1094" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1095">Hardware Requirements<span id="RotaryEncoderSpeedExample-1" class="anchor_target"></span></h3><ul type="disc"><li><p>Arduino Due board</p></li><li><p>MinSegShield&#8482; Kit M2V3.2</p></li><li><p>9V battery pack</p></li></ul><span id="zmw57dd0e1108" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1109">Hardware Setup<span id="RotaryEncoderSpeedExample-2" class="anchor_target"></span></h3><p>Assemble the hardware:</p><ul type="disc"><li><p>Attach the MinSegShield M2V3.2 to Arduino Due board.</p></li></ul><ul type="disc"><li><p>Connect the Vcc of the battery pack to VIN port on the 2-terminal block on the MinSegShield.</p></li></ul><ul type="disc"><li><p>Connect the Gnd of the battery pack to GND port on the 2-terminal block on the MinSegShield.</p></li></ul><p>
<img src="../../../examples/arduinoio_product/win64/RotaryEncoderSpeedExample_01.png" alt=""></p><p>
 </p><span id="zmw57dd0e1132" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1133">Create Rotary Encoder Objects<span id="RotaryEncoderSpeedExample-3" class="anchor_target"></span></h3><p>Create an arduino object, and include the <code>'RotaryEncoder'</code> library.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   a = arduino(<span style="color:#A020F0">'COM4'</span>,<span style="color:#A020F0">'Due'</span>,<span style="color:#A020F0">'Libraries'</span>,<span style="color:#A020F0">'RotaryEncoder'</span>)
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>
a = 

  arduino with properties:

                    Port: 'COM4'
                   Board: 'Due'
           AvailablePins: {'D2-D53', 'A0-A11'}
               Libraries: {'RotaryEncoder'}

</pre></div></div></div><p>Create rotary encoder objects for two encoders, specifying the connected output channel A and channel B pins. The quadrature encoder that comes with the kit has a resolution of 180 pulses per revolution.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   channelA1 = <span style="color:#A020F0">'A8'</span>;
   channelB1 = <span style="color:#A020F0">'D15'</span>;
   channelA2 = <span style="color:#A020F0">'D18'</span>;
   channelB2 = <span style="color:#A020F0">'D19'</span>;
   encoder1 = rotaryEncoder(a,channelA1,channelB1,180)
   encoder2 = rotaryEncoder(a,channelA2,channelB2,180)
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>
encoder1 = 

  rotaryEncoder with properties:

           ChannelA: 'A8'
           ChannelB: 'D15'
PulsesPerRevolution: 180


encoder2 = 

  rotaryEncoder with properties:

           ChannelA: 'D18'
           ChannelB: 'D19'
PulsesPerRevolution: 180

</pre></div></div></div><span id="zmw57dd0e1151" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1152">Turn On Motors<span id="RotaryEncoderSpeedExample-5" class="anchor_target"></span></h3><p>Each motor is controlled by a PWM pin for speed and a digital pin for direction. To turn on a motor, set the PWM voltage to above 0 and set the digital pin output to either 0 or 1 for forward or backward direction.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>  motor1SpeedPin = <span style="color:#A020F0">'D2'</span>;
  motor1DirectionPin = <span style="color:#A020F0">'D5'</span>;
  motor2SpeedPin = <span style="color:#A020F0">'D6'</span>;
  motor2DirectionPin = <span style="color:#A020F0">'D8'</span>;
</pre></div></div></div><p>Start rotating both motors by applying the same PWM voltage and setting the same direction.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>  direction = 0;
  initialPWMVoltage = 1.5;
  writeDigitalPin(a,motor1DirectionPin,direction);
  writeDigitalPin(a,motor2DirectionPin,direction);
  writePWMVoltage(a,motor1SpeedPin,initialPWMVoltage);
  writePWMVoltage(a,motor2SpeedPin,initialPWMVoltage);
  <span style="color:#228B22">% wait for the change to take effect on the hardware</span>
  pause(3);
</pre></div></div></div><span id="zmw57dd0e1163" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1164">Measure Motor Speeds<span id="RotaryEncoderSpeedExample-7" class="anchor_target"></span></h3><p>To measure one motor speed, pass in the corresponding encoder object.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   rpm = readSpeed(encoder1);
   fprintf(<span style="color:#A020F0">'Current motor speed is: %.2f\n'</span>,rpm);
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Current motor speed is: -45.83
</pre></div></div></div><p>To measure both motor speeds at the same time, pass in an array of the two encoder objects.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   rpms = readSpeed([encoder1,encoder2]);
   fprintf(<span style="color:#A020F0">'Current motor speeds are: %.2f, %.2f\n'</span>,rpms(1),rpms(2));
</pre></div></div></div><div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>Current motor speeds are: -45.83, -45.83
</pre></div></div></div><span id="zmw57dd0e1179" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1180">Steer Robot Straight<span id="RotaryEncoderSpeedExample-9" class="anchor_target"></span></h3><p>Generally, applying the same power to each wheel does not result in both motors rotating at the same speed, hence the robot does not move straight. To make it go straight, a closed-loop control algorithm is used to adjust the power applied to the two motors based on difference in their actual speeds. In this example, the proportional controller is used to help adjust the speeds. The following diagram explains the controller logic.</p><p>
<img src="../../../examples/arduinoio_product/win64/RotaryEncoderSpeedExample_02.png" alt=""></p><p>
 </p><p>Define controller execution time, target speed, sampling period, and proportional gain parameter.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   executionTime = 5;
   targetSpeed = -50;
   period = 0.1;
   Kp = 0.002;
</pre></div></div></div><p>Implement the closed-loop control algorithm to read both motor speeds and adjust one motor speed based on the difference. Make sure the shield is powered with 9V battery pack so that the motors rotate properly.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   tic;
   <span style="color:#0000FF">while</span> toc &lt; executionTime
       rpms = readSpeed([encoder1,encoder2]);
       diff = rpms-targetSpeed;
       newPWMVoltages = initialPWMVoltage - diff*Kp;
       writePWMVoltage(a,motor1SpeedPin,newPWMVoltages(1));
       writePWMVoltage(a,motor2SpeedPin,newPWMVoltages(2));
       pause(period);
   <span style="color:#0000FF">end</span>
</pre></div></div></div><p>Stop the motors by not applying power through the PWM pins.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>   writePWMVoltage(a,motor1SpeedPin,0);
   writePWMVoltage(a,motor2SpeedPin,0);
</pre></div></div></div><p>Note that the controller is running in soft real-time as it runs in MATLAB but not on the Arduino hardware. Hence, the quality of the control is affected by any other task running on your computer at the same time, such as anti-virus activities. To get hard real-time control, use the <a href="http://www.mathworks.com/hardware-support/arduino-simulink.html" target="_top">Simulink Arduino Support Package</a>.</p><span id="zmw57dd0e1208" class="anchor_target"></span><h3 class="title" id="zmw57dd0e1209">Clean Up<span id="RotaryEncoderSpeedExample-13" class="anchor_target"></span></h3><p>When the connection is no longer needed, clear the rotary encoder objects and arduino object.</p><div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>  clear <span style="color:#A020F0">encoder1</span> <span style="color:#A020F0">encoder2</span> <span style="color:#A020F0">a</span>
</pre></div></div></div></div>
</div></section>

<div class="clearfix"></div>
<div class="feedbackblock">Was this topic helpful?
<input type="button" value="Yes" onClick="openFeedbackWindow('http://www.mathworks.com/programs/bounce_hub_help.html?s_cid=Help_Topic_Survey&amp;surveyParams='+document.location.href+'-YES-R2017a');">
<input type="button" value="No" onClick="openFeedbackWindow('http://www.mathworks.com/programs/bounce_hub_help.html?s_cid=Help_Topic_Survey&amp;surveyParams='+document.location.href+'-NO-R2017a');">
</div>
<!--Last updated: Thu Jun 22 14:14:10 EDT 2017-->
</div>
</div>
</div><!--close_0960-->
</div><!--close_0970-->
<div class="body_trail_container">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">
<div class="row"><div class="col-xs-12 col-sm-3"><h5><a href="../index.html?s_cid=doc_ftr">MATLAB Support Package for Arduino Hardware Documentation</a></h5>
<ul class="list-unstyled hidden-xs"><li><a href="../index.html?s_cid=doc_ftr">Documentation</a></li>
<li><a href="../troubleshooting-in-matlab-support-package-for-arduino-hardware.html?s_cid=doc_ftr">Troubleshooting</a></li>
<li><a href="../functionlist.html?s_cid=doc_ftr">Functions and Other Reference</a></li>
<li><a href="../release-notes.html?s_cid=doc_ftr">Release Notes</a></li>
</ul>
</div>
<div class="col-xs-12 col-sm-3"><h5><a href="../../../documentation-center.html?s_cid=doc_ftr">Other Documentation</a></h5>
<ul class="list-unstyled hidden-xs"><li><a href="../../../matlab/index.html?s_cid=doc_ftr">MATLAB</a></li><li><a href="../../../supportpkg/arduino/index.html?s_cid=doc_ftr">Simulink Support Package for Arduino Hardware</a></li><li><a href="../../../supportpkg/raspberrypiio/index.html?s_cid=doc_ftr">MATLAB Support Package for Raspberry Pi Hardware</a></li><li><a href="../../../supportpkg/legomindstormsev3io/index.html?s_cid=doc_ftr">MATLAB Support Package for LEGO MINDSTORMS EV3 Hardware</a></li><li><a href="../../../documentation-center.html?s_cid=doc_ftr">Documentation Home</a></li></ul>
</div>
<div class="col-xs-12 col-sm-3"><h5><a href="http://www.mathworks.com/support/?s_cid=doc_ftr">Support</a></h5>
<ul class="list-unstyled hidden-xs"><li><a href="http://www.mathworks.com/matlabcentral/answers/index?s_cid=doc_ftr">MATLAB Answers</a></li><li><a href="http://www.mathworks.com/support/install-matlab.html?s_cid=doc_ftr">Installation Help</a></li><li><a href="http://www.mathworks.com/support/bugreports/?s_cid=doc_ftr">Bug Reports</a></li><li><a href="http://www.mathworks.com/products/availability/?s_cid=doc_ftr">Product Requirements</a></li><li><a href="http://www.mathworks.com/downloads/?s_cid=doc_ftr">Software Downloads</a></li></ul>
</div>
</div>
</div>
</div>
</div><!--END.CLASS container-fluid-->
</div><!--END.CLASS body_trail_container-->
<footer id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">&copy; 1994-2017 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="MATLAB:web(matlab.internal.licenseAgreement)">Terms of Use</a></li><li class="footernav_patents"><a href="MATLAB:web([matlabroot '/patents.txt'])">Patents</a></li><li class="footernav_trademarks"><a href="MATLAB:web([matlabroot '/trademarks.txt'])">Trademarks</a></li><li class="footernav_piracy"><a href="MATLAB:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li></ul></div>
</div>
</div>
</div>
</footer>
</div><!--close row-offcanvas-->
</body>
</html>
